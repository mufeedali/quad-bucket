#!/bin/sh
# Run qh generate env in hook mode; abort if qh exits 1.

if ! command -v qh >/dev/null 2>&1; then
  exit 0
fi

qh generate env --hook >/dev/null 2>&1
rc=$?
if [ "$rc" -eq 0 ]; then
  exit 0
fi
if [ "$rc" -eq 1 ]; then
  echo "qh generated or modified files. Review, stage, and re-run commit."
  git --no-pager status --short
  exit 1
fi

echo "qh failed (exit $rc)."
exit $rc
